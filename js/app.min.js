var Model={yelpData:[],mapData:{place:[{name:"Soul de Cuba Cafe",location:"1180 Sunset Drive",city:"Kelowna",province:"BC",phone:"(778)478-9529",typeD:"food"},{name:"Project ME",location:"1083 Sunset Drive",city:"Kelowna",province:"BC",phone:"(403)970-8442",typeD:"professional services"},{name:"Bean Scene Downtown",location:"274 Bernard Ave",city:"Kelowna",province:"BC",phone:"(250)763-1814",typeD:"food"},{name:"Csek Creative",location:"1441 Ellis Street",city:"Kelowna",province:"BC",phone:"(250)862-8010",typeD:"professional services"},{name:"Goodsir",location:"1-1331 Ellis St",city:"Kelowna",province:"BC",phone:"(250)763-9907",typeD:"professional services"}]},wikiData:{}};var ViewModel={self:this,init:function(){window.addEventListener("load",View.initializeMap(Model.mapData));window.addEventListener("resize",function(b){map.fitBounds(mapBounds)});for(var a in Model.mapData.place){ViewModel.importYelp("business",ViewModel.searchString((Model.mapData.place[a].location+"-"+Model.place[a].city)),ViewModel.searchString(Model.mapData.place[a].name))}console.log(Model.yelpData)},nonce_generate:function(){var c=5+(Math.floor(Math.random()*32));var d="";var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var b=0;b<c;b++){d+=a.charAt(Math.floor(Math.random()*a.length))}return d},importYelp:function(b,c,a){var g=YELP_BASE_URL;var e={oauth_consumer_key:YELP_KEY,oauth_token:YELP_TOKEN,oauth_nonce:ViewModel.nonce_generate(),oauth_timestamp:Math.floor(Date.now()/1000),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",limit:1,term:b,location:c,business:a};var f=oauthSignature.generate("GET",g,e,YELP_KEY_SECRET,YELP_TOKEN_SECRET);e.oauth_signature=f;var d={url:g,data:e,cache:true,dataType:"jsonp",success:function(h){Model.yelpData.push(h)},error:function(){console.log("Failed to import Data")}};console.log(d);$.ajax(d)},searchString:function(b){for(var a in b){b=b.replace(" ","+");b=b.replace(", ","+");b=b.replace(",","+");b=b.replace("++","+")}return(b)},importWiki:function(b){var c="http://en.wikipedia.org/w/api.php?action=opensearch&search="+b+"&format=json&callback=wikiCallback";var a=setTimeout(function(){console.log("Failed to get wikipedia resources")},8000);$.ajax({url:c,dataType:"jsonp",success:function(d){var e=d[1];console.log(e);clearTimeout(a)}})},};var View={initializeMap:function(g){console.log(g);var b;var c={disableDefaultUI:true,noClear:true};map=new google.maps.Map(document.querySelector("#map"),c);function f(){var j=[];for(var k in g.place){j.push(g.place[k].location+", "+g.place[k].city+", "+g.place[k].province)}console.log(j);return j}function a(o){var m=o.geometry.location.lat();var n=o.geometry.location.lng();var j=o.formatted_address;var l=window.mapBounds;var i=new google.maps.Marker({map:map,position:o.geometry.location,title:j});var k=new google.maps.InfoWindow({content:j});google.maps.event.addListener(i,"click",function(){k.open(map,i)});l.extend(new google.maps.LatLng(m,n));map.fitBounds(l);map.setCenter(l.getCenter())}function h(j,i){if(i==google.maps.places.PlacesServiceStatus.OK){a(j[0])}}function e(j){var i=new google.maps.places.PlacesService(map);for(var k in j){var l={query:j[k]};i.textSearch(l,h)}}window.mapBounds=new google.maps.LatLngBounds();b=f();for(var d in b){b[d]=ViewModel.searchString(b[d])}e(b)}};ViewModel.init();
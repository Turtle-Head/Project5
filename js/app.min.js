var Model={yelpData:[],mapData:{place:[{name:"Dunn Enzies",location:"1559 Ellis Street",city:"Kelowna",province:"BC",phone:"(250)763-2420"},{name:"Mad Mango Cafe",location:"551 Bernard Avenue",city:"Kelowna",province:"BC",phone:"(250)762-8988"},{name:"Bean Scene Downtown",location:"274 Bernard Ave",city:"Kelowna",province:"BC",phone:"(250)763-1814"},{name:"Csek Creative",location:"1441 Ellis Street",city:"Kelowna",province:"BC",phone:"(250)862-8010"},{name:"Goodsir",location:"1331 Ellis Street",city:"Kelowna",province:"BC",phone:"(250)763-9907"}]},wikiData:[]};var ViewModel={self:this,init:function(){window.addEventListener("load",View.initializeMap(Model.mapData));window.addEventListener("resize",function(c){map.fitBounds(mapBounds)});for(var b in Model.mapData.place){ViewModel.importYelp(Model.mapData.place[b].name,Model.mapData.place[b].location,Model.mapData.place[b].city,Model.mapData.place[b].name)}ViewModel.importWiki(ViewModel.searchString(Model.mapData.place[0].city));for(var a in Model.mapData.place){ViewModel.importWiki(ViewModel.searchString(Model.mapData.place[a].name))}console.log("Yelp: ");console.log(Model.yelpData);console.log("Wiki: ");console.log(Model.wikiData);console.log("K. Cap. News: ");console.log(Model.kdcData)},nonce_generate:function(){var c=5+(Math.floor(Math.random()*32));var d="";var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var b=0;b<c;b++){d+=a.charAt(Math.floor(Math.random()*a.length))}return d},importYelp:function(b,c,h){var a=ViewModel.nonce_generate();var g=YELP_BASE_URL;var e={oauth_consumer_key:YELP_KEY,oauth_token:YELP_TOKEN,oauth_nonce:ViewModel.nonce_generate(),oauth_timestamp:Math.floor(Date.now()/1000),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",limit:1,term:b+" "+h,location:c,id:b+" "+h,city:"Kelowna",province:"British Columbia",cc:"CA"};var f=oauthSignature.generate("GET",g,e,YELP_KEY_SECRET,YELP_TOKEN_SECRET);e.oauth_signature=f;var d={url:g,data:e,cache:true,dataType:"jsonp",success:function(i){Model.yelpData.push(i)},error:function(){console.log("Failed to import Data")}};console.log(d);$.ajax(d)},searchString:function(b){for(var a in b){b=b.replace(" ","+");b=b.replace(", ","+");b=b.replace(",","+");b=b.replace("++","+")}return(b)},searchYelp:function(b){for(var a in b){b=b.replace(" ","-");b=b.replace(", ","-");b=b.replace(",","-");b=b.replace("++","-");b=b.replace("--","-");b=b.replace("+","-")}},importWiki:function(b){var c="http://en.wikipedia.org/w/api.php?action=opensearch&search="+b+"&format=json&callback=wikiCallback";var a=setTimeout(function(){console.log("Failed to get wikipedia resources")},8000);$.ajax({url:c,dataType:"jsonp",success:function(d){Model.wikiData.push(d);clearTimeout(a)}})},};var View={initializeMap:function(g){console.log(g);var b;var c={disableDefaultUI:true,noClear:true};map=new google.maps.Map(document.querySelector("#map"),c);function f(){var j=[];for(var k in g.place){j.push(g.place[k].location+", "+g.place[k].city+", "+g.place[k].province)}console.log(j);return j}function a(o){var m=o.geometry.location.lat();var n=o.geometry.location.lng();var j=o.formatted_address;var l=window.mapBounds;var i=new google.maps.Marker({map:map,position:o.geometry.location,title:j});var k=new google.maps.InfoWindow({content:j});google.maps.event.addListener(i,"click",function(){k.open(map,i)});l.extend(new google.maps.LatLng(m,n));map.fitBounds(l);map.setCenter(l.getCenter())}function h(j,i){if(i==google.maps.places.PlacesServiceStatus.OK){a(j[0])}}function e(j){var i=new google.maps.places.PlacesService(map);for(var k in j){var l={query:j[k]};i.textSearch(l,h)}}window.mapBounds=new google.maps.LatLngBounds();b=f();for(var d in b){b[d]=ViewModel.searchString(b[d])}e(b)}};ViewModel.init();
var ViewModel={self:this,init:function(){window.addEventListener("load",View.initializeMap(Model.mapData));window.addEventListener("resize",function(a){map.fitBounds(mapBounds)})},nonce_generate:function(){var c=5+(Math.floor(Math.random()*32));var d="";var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var b=0;b<c;b++){d+=a.charAt(Math.floor(Math.random()*a.length))}return d},importYelp:function(a,b){var f=YELP_BASE_URL;var d={oauth_consumer_key:YELP_KEY,oauth_token:YELP_TOKEN,oauth_nonce:ViewModel.nonce_generate(),oauth_timestamp:Math.floor(Date.now()/1000),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",limit:20,term:a,location:b};var e=oauthSignature.generate("GET",f,d,YELP_KEY_SECRET,YELP_TOKEN_SECRET);d.oauth_signature=e;var c={url:f,data:d,cache:true,dataType:"jsonp",success:function(g){console.log(g)},error:function(){console.log("Failed to import Data")}};$.ajax(c)},searchString:function(b){for(var a in b){b=b.replace(" ","+");b=b.replace(", ","+");b=b.replace(",","+");b=b.replace("++","+")}return(b)},importWiki:function(b){var c="http://en.wikipedia.org/w/api.php?action=opensearch&search="+b+"&format=json&callback=wikiCallback";var a=setTimeout(function(){console.log("Failed to get wikipedia resources")},8000);$.ajax({url:c,dataType:"jsonp",success:function(d){var e=d[1];console.log(e);clearTimeout(a)}})},};var Model={yelpData:{},mapData:{place:[{name:"Soul de Cuba Cafe",location:"1180 Sunset Drive, Kelowna, BC",phone:"(778)478-9529"},{name:"Project ME",location:"1083 Sunset Drive, Kelowna, BC",phone:"(403)970-8442"},{name:"Bean Scene Downtown",location:"274 Bernard Ave, Kelowna, BC",phone:"(250)763-1814"},{name:"Csek Creative",location:"1441 Ellis Street, Kelowna, BC",phone:"(250)862-8010"},{name:"Goodsir",location:"1-1331 Ellis St, Kelowna, BC",phone:"(250)763-9907"}]},wikiData:{}};var View={initializeMap:function(g){console.log(g);var b;var c={disableDefaultUI:true,noClear:true};map=new google.maps.Map(document.querySelector("#map"),c);function f(){var j=[];for(var k in g.place){j.push(g.place[k].location)}console.log(j);return j}function a(o){var m=o.geometry.location.lat();var n=o.geometry.location.lng();var j=o.formatted_address;var l=window.mapBounds;var i=new google.maps.Marker({map:map,position:o.geometry.location,title:j});var k=new google.maps.InfoWindow({content:j});google.maps.event.addListener(i,"click",function(){k.open(map,i)});l.extend(new google.maps.LatLng(m,n));map.fitBounds(l);map.setCenter(l.getCenter())}function h(j,i){if(i==google.maps.places.PlacesServiceStatus.OK){a(j[0])}}function e(j){var i=new google.maps.places.PlacesService(map);for(var k in j){var l={query:j[k]};i.textSearch(l,h)}}window.mapBounds=new google.maps.LatLngBounds();b=f();for(var d in b){b[d]=ViewModel.searchString(b[d])}e(b)}};ViewModel.init();
function searchString(b){for(var a in b){b=b.replace(" ","+");b=b.replace(", ","+");b=b.replace(",","+");b=b.replace("++","+")}return(b)}function PlaceData(a,g){var i=this;i.name=ko.observable(a);i.address=ko.observable(g);i.city=ko.observable("Kelowna");i.province=ko.observable("British Columbia");i.location=searchString(i.address())+"+Kelowna+British+Columbia";i.yelp=ko.observable(0);i.contentString=ko.observable("<div>"+i.name()+"</div>");var e;for(var d=0;d<Math.floor(Math.random()*Math.floor(Math.random()*20));d++){e=nonce_generate()}var f=YELP_BASE_URL;var j;var h={oauth_consumer_key:YELP_KEY,oauth_token:YELP_TOKEN,oauth_nonce:nonce_generate(),oauth_timestamp:Math.floor(Date.now()/1000),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",limit:1,term:a+" Kelowna",location:g,id:a+" Kelowna",city:"Kelowna",province:"British Columbia",cc:"CA"};var b=oauthSignature.generate("GET",f,h,YELP_KEY_SECRET,YELP_TOKEN_SECRET);h.oauth_signature=b;var c={url:f,data:h,cache:true,dataType:"jsonp",success:function(k){i.yelp(k.businesses[0]);i.contentString(i.contentString()+'<div class="flex"><img src="https://maps.googleapis.com/maps/api/streetview?size=350x150&location='+searchString(k.businesses[0].location.address[0])+'Kelowna+British+Columbia" width="350px"><img src="'+k.businesses[0].image_url+'" height="150px"><img src="'+k.businesses[0].snippet_image_url+'" height="150px"></div></div><div class="flex"><div width="350px"><ul><li>');i.contentString(i.contentString()+"<address>"+k.businesses[0].location.display_address[0]+"<br>"+k.businesses[0].location.display_address[1]+"</address></li><li>"+k.businesses[0].display_phone+"</li><li>Rating: "+k.businesses[0].rating+"</li></ul></div>");i.contentString(i.contentString()+'<div padding="5px"><img padding="15px" src="'+k.businesses[0].rating_img_url+'" width="150px"></div><div width="100px">'+k.businesses[0].snippet_text+"</div></div>")},error:function(){console.log("Failed to import Data")}};$.ajax(c);console.log("ID: ");console.log(i.yelp()["id"])}function ViewModel(){var a=this;a.places=ko.observableArray([new PlaceData("The Grateful Fed Pub","509 Bernard Ave"),new PlaceData("Mad Mango Cafe","551 Bernard Ave"),new PlaceData("Bean Scene Downtown","274 Bernard Ave"),new PlaceData("Mosaic Books","411 Bernard Ave"),new PlaceData("Doc Willoughby's Public House","353 Bernard Ave"),new PlaceData("Landmark Cinemas Paramount","261 Bernard Ave"),new PlaceData("Fernando's Pub","279 Bernard Ave")]);console.log("Places Model:");console.log(a.places());initializeMap();$("infoWindow").each($("address").each(function(){var d=$(this).text();var c=$.trim(d).replace(/\r?\n/,",").replace(/\s+/g," ");var b='<a href="http://maps.google.com/maps?q='+encodeURIComponent(c)+'" target="_blank"></a>';return $(this).wrapInner(b)}));$("body").append('<div class="flex" align="center"><a href="http://maps.google.com"><img src="http://www.userlogos.org/files/logos/48414_v-toll/google_maps_logo.png?1428672032" height="75px"></a>   <a href="http://yelp.com"><img src="https://s3-media1.fl.yelpcdn.com/assets/srv0/www_pages/43ed502d1f6e/assets/img/brand_guidelines/yelp-2c.png" height="75px"></a></div>')}function nonce_generate(){var c=(Math.floor(Math.random()*32))+(Math.floor(Math.random()*32));var d="";var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var b=0;b<c;b++){d+=a.charAt(Math.floor(Math.random()*a.length))}return d}function callback(c,a){if(a==google.maps.places.PlacesServiceStatus.OK){for(var b in places()){if(c[0].name.toLowerCase()==places()[b].address().toLowerCase()){createMapMarker(c[0],b)}}}}function createMapMarker(h,d){var j=h.geometry.location.lat();var b=h.geometry.location.lng();var c=h.formatted_address;var a=window.mapBounds;var i=new google.maps.Marker({map:map,position:h.geometry.location,title:c});var e;var g=places()[d].contentString();var f=new google.maps.InfoWindow({content:g});google.maps.event.addListener(i,"click",function(){f.open(map,i)});a.extend(new google.maps.LatLng(j,b));map.fitBounds(a);map.setCenter(a.getCenter())}function pinPoster(){var a=new google.maps.places.PlacesService(map);for(var c in places()){var b={query:places()[c].location};a.textSearch(b,callback)}}function initializeMap(){var a={disableDefaultUI:false,noClear:true};map=new google.maps.Map(document.querySelector("#map"),a);window.mapBounds=new google.maps.LatLngBounds();pinPoster()}ko.applyBindings(ViewModel());
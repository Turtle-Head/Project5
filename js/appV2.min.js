function searchString(b){for(var a in b){b=b.replace(" ","+");b=b.replace(", ","+");b=b.replace(",","+");b=b.replace("++","+")}return(b)}function PlaceData(a,h,b){var j=this;j.id=b;j.name=ko.observable(a);j.address=ko.observable(h);j.city=ko.observable("Kelowna");j.province=ko.observable("British Columbia");j.location=searchString(j.address())+"+Kelowna+British+Columbia";j.yelp=ko.observable(0);j.contentString=ko.observable("<div>"+j.name()+'</div><div class="button" id="'+j.id+'">More</div>');var f;for(var e=0;e<Math.floor(Math.random()*Math.floor(Math.random()*20));e++){f=nonce_generate()}var g=YELP_BASE_URL;var k;var i={oauth_consumer_key:YELP_KEY,oauth_token:YELP_TOKEN,oauth_nonce:nonce_generate(),oauth_timestamp:Math.floor(Date.now()/1000),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",limit:1,term:a+" Kelowna",location:h,id:a+" Kelowna",city:"Kelowna",province:"British Columbia",cc:"CA"};var c=oauthSignature.generate("GET",g,i,YELP_KEY_SECRET,YELP_TOKEN_SECRET);i.oauth_signature=c;var d={url:g,data:i,cache:true,dataType:"jsonp",success:function(m){j.yelp(m.businesses[0]);var l='<div class="flex"><img src="https://maps.googleapis.com/maps/api/streetview?size=350x150&location='+searchString(m.businesses[0].location.address[0])+'Kelowna+British+Columbia" width="350px"><img src="'+m.businesses[0].image_url+'" height="150px"><img src="'+m.businesses[0].snippet_image_url+'" height="150px"></div><div class="flex"><div width="350px"><ul><li>';l=l+"<address>"+m.businesses[0].location.display_address[0]+"<br>"+m.businesses[0].location.display_address[1]+"</address></li><li>"+m.businesses[0].display_phone+"</li><li>Rating: "+m.businesses[0].rating+"</li></ul></div>";l=l+'<div padding="5px"><img padding="15px" src="'+m.businesses[0].rating_img_url+'" width="150px"></div><div width="100px">'+m.businesses[0].snippet_text+"</div></div>";$("body").append('<div class="panel" id='+j.id+'_panel">'+l+"</div>");$("#"+j.id+"_panel").hide()},error:function(){console.log("Failed to import Data")}};$.ajax(d)}function ViewModel(){var b=this;b.places=ko.observableArray([new PlaceData("The Grateful Fed Pub","509 Bernard Ave","tgfp"),new PlaceData("Mad Mango Cafe","551 Bernard Ave","mmc"),new PlaceData("Bean Scene Downtown","274 Bernard Ave","bsd"),new PlaceData("Mosaic Books","411 Bernard Ave","mosaic"),new PlaceData("Landmark Cinemas Paramount","261 Bernard Ave","lcp")]);console.log("Places Model:");console.log(b.places());initializeMap();$("body").prepend('<div class="flex" align="center"><a href="http://maps.google.com"><img src="http://www.userlogos.org/files/logos/48414_v-toll/google_maps_logo.png?1428672032" height="75px"></a>   <a href="http://yelp.com"><img src="https://s3-media1.fl.yelpcdn.com/assets/srv0/www_pages/43ed502d1f6e/assets/img/brand_guidelines/yelp-2c.png" height="75px"></a></div>');for(var a in b.places){$("#"+places()[a].id).click($("#"+places()[a].id+"_panel").toggle("slow"));$("#"+places()[a].id+"_panel").click($("#"+places()[a].id+"_panel").toggle("slow"))}}function nonce_generate(){var c=(Math.floor(Math.random()*32))+(Math.floor(Math.random()*32));var d="";var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var b=0;b<c;b++){d+=a.charAt(Math.floor(Math.random()*a.length))}return d}function callback(c,a){if(a==google.maps.places.PlacesServiceStatus.OK){for(var b in places()){if(c[0].name.toLowerCase()==places()[b].address().toLowerCase()){createMapMarker(c[0],b)}}}}function createMapMarker(g,d){var i=g.geometry.location.lat();var b=g.geometry.location.lng();var c=g.formatted_address;var a=window.mapBounds;var h=new google.maps.Marker({map:map,position:g.geometry.location,title:c});var f=places()[d].contentString();var e=new google.maps.InfoWindow({content:f});google.maps.event.addListener(h,"click",function(){e.open(map,h)});a.extend(new google.maps.LatLng(i,b));map.fitBounds(a);map.setCenter(a.getCenter())}function pinPoster(){var a=new google.maps.places.PlacesService(map);for(var c in places()){var b={query:places()[c].location};a.textSearch(b,callback)}}function initializeMap(){var a={disableDefaultUI:false,noClear:true};map=new google.maps.Map(document.querySelector("#map"),a);window.mapBounds=new google.maps.LatLngBounds();pinPoster()}ko.applyBindings(ViewModel());